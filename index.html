<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>canvas+FabricJS</title>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/fabric.js/1.4.0/fabric.min.js"></script>
    <style type="text/css">
        canvas {
            border: 1px solid #ddd;
        }
    </style>
    <script>
        var canvas;
        var grid = 50;
        var info;

        var addRect = function (name, width, height) {
            var rect = new fabric.Rect({
                left: 0,
                top: 0,
                width: width * grid,
                height: height * grid,
                fill: '#ccc',
                hasControls: false,
                name: name,
                hodnota: width * height
            });
            canvas.add(rect);
            info.innerHTML = '';
        };

        var changeRect = function (el) {
            canvas.getActiveObject()['hodnota'] = el.value;
        };

        var deleteRect = function (el) {
            var selected = canvas.getActiveObject();
            canvas.remove(selected);
            info.innerHTML = '';
        };

        var resize = function () {
            canvas.setWidth(600);
            canvas.setHeight(400);

            _createGrid();
        };

        var exportData = function () {
            var exportedData = '\'canvas\';' + canvas.getWidth() + ';' + canvas.getHeight() + ';\n';
            canvas.forEachObject(function (o) {
                if (o.get('name') !== 'grid') {
                    exportedData += '\'' + o.get('name') + '\';' + o.get('left') + ';' + o.get('top') + ';' + o.get('hodnota') + ';\n';
                }
            });
            document.getElementById('exportedData').value = exportedData;
        };

        var _createGrid = function () {
            canvas.forEachObject(function (o) {
                if (o.get('name') === 'grid') {
                    canvas.remove(o);
                }
            });

            for (var i = 1; i < (canvas.getWidth() / grid) ; i++) {
                canvas.add(new fabric.Line([i * grid, 0, i * grid, canvas.getHeight()], {
                    stroke: '#eee',
                    selectable: false,
                    originX: 'center',
                    originY: 'center',
                    name: 'grid'
                }));
                canvas.add(new fabric.Line([0, i * grid, canvas.getWidth(), i * grid], {
                    stroke: '#eee',
                    selectable: false,
                    originX: 'center',
                    originY: 'center',
                    name: 'grid'
                }));
            }

            canvas.forEachObject(function (o) {
                if (o.get('name') === 'grid') {
                    canvas.sendToBack(o);
                } else {
                    canvas.bringToFront(o);
                }
            });

            canvas.renderAll();
        };

        window.onload = function () {
            info = document.getElementById('info');

            canvas = new fabric.Canvas('c', {
                selection: false
            });

            _createGrid();

            canvas.on('object:moving', function (options) {
                options.target.set({
                    left: Math.round(options.target.left / grid) * grid,
                    top: Math.round(options.target.top / grid) * grid
                });
            });

            canvas.on('object:selected', function (options) {
                canvas.bringToFront(options.target);
                var hodnota = '<input type="text" id="hodnota" value="' + options.target.get('hodnota') + '" onkeyup="changeRect(this);">';
                info.innerHTML = 'Name:' + options.target.get('name') + '<br>Hodnota:' + hodnota + '<br><button onclick="deleteRect();">DELETE</button>';
            });

            canvas.on('selection:cleared', function (options) {
                info.innerHTML = '';
            });
        }
    </script>
</head>
<body>
    <div style="float: left; position: relative">
        <ul>
            <li><div style="width: 50px; height: 50px; background-color: #ccc; cursor: pointer;" onclick="addRect('1x1', 1, 1);"></div></li>
            <li><div style="width: 50px; height: 100px; background-color: #ccc; cursor: pointer;" onclick="addRect('1x2', 1, 2);"></div></li>
            <li><div style="width: 100px; height: 50px; background-color: #ccc; cursor: pointer;" onclick="addRect('2x1', 2, 1);"></div></li>
            <li><div style="width: 100px; height: 100px; background-color: #ccc; cursor: pointer;" onclick="addRect('2x2', 2, 2);"></div></li>
        </ul>
    </div>
    <div style="float: left; position: relative; padding-left: 50px; padding-right: 50px;">
        <canvas id="c" width="400" height="300"></canvas>
        <button onclick="resize();">RESIZE</button>
    </div>
    <div style="float: left; position: relative">
        <div id="info"></div>
    </div>
    <hr style="clear: both;">
    <button onclick="exportData()">EXPORT</button>
    <textarea id="exportedData" cols="100" rows="5"></textarea>
</body>
</html>
